<!DOCTYPE html>
<html>
<head>
    <title>Zip 文件内容搜索 (Zip File Content Search)</title>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
        }
        input[type="file"], input[type="text"], button {
            margin-bottom: 1em;
        }
    </style>
</head>
<body>

    <h1>在 Zip 文件中搜索文本 (Search for Text in a Zip File)</h1>
    <p>上传一个 zip 文件，然后输入您想要查找的内容。(Upload a zip file and enter the content you want to search for.)</p>

    <input type="file" id="zipFile" accept=".zip">
    <br>
    <input type="text" id="searchText" placeholder="输入搜索内容 (Enter search text)">
    <br>
    <button onclick="searchInZip()">搜索 (Search)</button>

    <h2>搜索结果 (Search Results):</h2>
    <div id="results"></div>

    <script>
        async function searchInZip() {
            const zipFileInput = document.getElementById('zipFile');
            const searchText = document.getElementById('searchText').value;
            const resultsDiv = document.getElementById('results');

            resultsDiv.innerHTML = '';

            if (zipFileInput.files.length === 0) {
                alert('请选择一个 zip 文件。(Please select a zip file.)');
                return;
            }

            if (searchText.trim() === '') {
                alert('请输入要搜索的内容。(Please enter the text to search for.)');
                return;
            }

            const file = zipFileInput.files[0];
            
            const reader = new FileReader();
            reader.onload = async function(event) {
                try {
                    const zip = await JSZip.loadAsync(event.target.result);
                    const foundFiles = [];
                    const textExtensions = ['txt', 'js', 'json', 'html', 'css', 'xml', 'csv', 'md', 'py', 'java', 'c', 'cpp', 'h', 'hpp', 'cs', 'php', 'rb', 'go', 'rs', 'swift', 'kt', 'kts', 'groovy', 'lua', 'pl', 'sh', 'bat', 'sql', 'yaml', 'toml'];
                    const promises = [];

                    zip.forEach((relativePath, zipEntry) => {
                        const fileName = zipEntry.name;
                        const fileExtension = fileName.split('.').pop().toLowerCase();

                        if (!zipEntry.dir && textExtensions.includes(fileExtension)) {
                            const promise = zipEntry.async('string').then(content => {
                                if (content.includes(searchText)) {
                                    foundFiles.push(fileName);
                                }
                            });
                            promises.push(promise);
                        }
                    });

                    await Promise.all(promises);

                    if (foundFiles.length > 0) {
                        const ul = document.createElement('ul');
                        foundFiles.forEach(fileName => {
                            const li = document.createElement('li');
                            li.textContent = fileName;
                            ul.appendChild(li);
                        });
                        resultsDiv.appendChild(ul);
                    } else {
                        resultsDiv.innerHTML = '<p>在任何文本文件中都未找到该内容。(The content was not found in any text files.)</p>';
                    }
                } catch (e) {
                    alert('解析 zip 文件时出错。(An error occurred while parsing the zip file.)');
                    console.error(e);
                }
            };
            reader.readAsArrayBuffer(file);
        }
    </script>

</body>
</html>
```<!DOCTYPE html>
<html>
<head>
    <title>Zip 文件内容搜索 (Zip File Content Search)</title>
    <meta charset="UTF-8">
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js](https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js)"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            margin: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        h1, h2 {
            border-bottom: 2px solid #eaecef;
            padding-bottom: .3em;
        }
        input[type="file"], input[type="text"], button {
            display: block;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #d1d5da;
        }
        button {
            background-color: #2ea44f;
            color: white;
            border: 1px solid rgba(27, 31, 35, .15);
            cursor: pointer;
        }
        button:hover {
            background-color: #2c974b;
        }
        #results ul {
            list-style-type: none;
            padding: 0;
        }
        #results li {
            background-color: #f6f8fa;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <h1>在 Zip 文件中搜索文本 (Search for Text in a Zip File)</h1>
    <p>上传一个 zip 文件，然后输入您想要查找的内容。(Upload a zip file and enter the content you want to search for.)</p>

    <input type="file" id="zipFile" accept=".zip">
    <input type="text" id="searchText" placeholder="输入搜索内容 (Enter search text)" style="width: 300px;">
    <button onclick="searchInZip()">搜索 (Search)</button>

    <h2>搜索结果 (Search Results):</h2>
    <div id="results"></div>

    <script>
        async function searchInZip() {
            const zipFileInput = document.getElementById('zipFile');
            const searchText = document.getElementById('searchText').value;
            const resultsDiv = document.getElementById('results');

            resultsDiv.innerHTML = '正在搜索... (Searching...)';

            if (zipFileInput.files.length === 0) {
                alert('请选择一个 zip 文件。(Please select a zip file.)');
                resultsDiv.innerHTML = '';
                return;
            }

            if (searchText.trim() === '') {
                alert('请输入要搜索的内容。(Please enter the text to search for.)');
                resultsDiv.innerHTML = '';
                return;
            }

            const file = zipFileInput.files[0];
            
            const reader = new FileReader();
            reader.onload = async function(event) {
                try {
                    const zip = await JSZip.loadAsync(event.target.result);
                    const foundFiles = [];
                    // 定义常见的文本文件扩展名
                    const textExtensions = ['txt', 'js', 'json', 'html', 'css', 'xml', 'csv', 'md', 'py', 'java', 'c', 'cpp', 'h', 'hpp', 'cs', 'php', 'rb', 'go', 'rs', 'swift', 'kt', 'kts', 'groovy', 'lua', 'pl', 'sh', 'bat', 'sql', 'yaml', 'toml', 'ini', 'log'];
                    const promises = [];

                    zip.forEach((relativePath, zipEntry) => {
                        const fileName = zipEntry.name;
                        const fileExtension = fileName.split('.').pop().toLowerCase();

                        if (!zipEntry.dir && textExtensions.includes(fileExtension)) {
                            const promise = zipEntry.async('string').then(content => {
                                if (content.includes(searchText)) {
                                    foundFiles.push(fileName);
                                }
                            }).catch(err => {
                                console.error(`无法读取文件 ${fileName} 的内容。(Could not read content of file ${fileName})`, err);
                            });
                            promises.push(promise);
                        }
                    });

                    await Promise.all(promises);

                    resultsDiv.innerHTML = '';

                    if (foundFiles.length > 0) {
                        const ul = document.createElement('ul');
                        foundFiles.forEach(fileName => {
                            const li = document.createElement('li');
                            li.textContent = fileName;
                            ul.appendChild(li);
                        });
                        resultsDiv.appendChild(ul);
                    } else {
                        resultsDiv.innerHTML = '<p>在任何文本文件中都未找到该内容。(The content was not found in any text files.)</p>';
                    }
                } catch (e) {
                    alert('解析 zip 文件时出错。请确保这是一个有效的 zip 文件。(An error occurred while parsing the zip file. Please ensure it is a valid zip file.)');
                    resultsDiv.innerHTML = '';
                    console.error(e);
                }
            };
            reader.readAsArrayBuffer(file);
        }
    </script>

</body>
</html>
